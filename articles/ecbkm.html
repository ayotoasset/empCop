<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Empirical Checkerboard Copula with known margins • empCop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Checkerboard Copula with known margins">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">empCop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/convexcombcopula.html">Convex combination of checkerbords with known margins</a>
    </li>
    <li>
      <a href="../articles/ecb.html">Empirical Checkerboard Copula</a>
    </li>
    <li>
      <a href="../articles/ecbkm.html">Empirical Checkerboard Copula with known margins</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrnv/empCop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Empirical Checkerboard Copula with known margins</h1>
                        <h4 class="author">Oskar Laverny</h4>
            
            <h4 class="date">2019-02-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrnv/empCop/blob/master/vignettes/ecbkm.Rmd"><code>vignettes/ecbkm.Rmd</code></a></small>
      <div class="hidden name"><code>ecbkm.Rmd</code></div>

    </div>

    
    
<p>The empirical checkerboard copula with known margins is a model for copula that uses priori information on a multidimentional margins to condition a checkerboard construction on the rest of the copula. This vignette describes the model in the first section, and then discuss current implementation in the second section</p>
<div id="ecbc-with-known-margins" class="section level2">
<h2 class="hasAnchor">
<a href="#ecbc-with-known-margins" class="anchor"></a>ECBC with known margins</h2>
<div id="preliminary-notations" class="section level3">
<h3 class="hasAnchor">
<a href="#preliminary-notations" class="anchor"></a>Preliminary notations</h3>
<p>First of all, for a certain dimension of the data at hand <span class="math inline">\(d\)</span> and a certain checkerboard parameter <span class="math inline">\(m\)</span>, let’s consider the ensemble of multi-indexes <span class="math inline">\(\mathcal{I} = \{\mathbf{i} = (i_1,..,i_d) \subset \{1,...,m \}^d\}\)</span> which indexes the boxes :</p>
<p><span class="math display">\[B_{\mathbf{i}} = \left]\frac{\mathbf{i}-1}{m},\frac{\mathbf{i}}{m}\right]\]</span></p>
<p>partitioning the space <span class="math inline">\(\mathbb{I}^d = [0,1]^d\)</span>. Denote the set of thoose boxes by <span class="math inline">\(\mathcal{B}_\mathcal{I} = \left\{B_{\mathbf{i}}, \mathbf{i} \in \mathcal{I}\right\}\)</span>. Furthermore, let’s choose <span class="math inline">\(p\)</span> dimensions that would be assigned to a known copula, by setting : <span class="math inline">\(J \subset \{1,...,d\}, |J| = p\)</span> and let’s define proper projections for the boxes :</p>
<p><span class="math display">\[B^J_{\mathbf{i}} = \{ \mathbf{x} \in [0,1]^p, x_j \in \left]\frac{i_j-1}{m},\frac{i_j}{m}\right] \forall j \in J \}\]</span></p>
<p><span class="math display">\[B^{-J}_{\mathbf{i}} = \{\mathbf{x} \in [0,1]^p, x_j \in \left]\frac{i_j-1}{m},\frac{i_j}{m}\right] \forall j \notin J \}\]</span></p>
<p>such that <span class="math inline">\(B_{\mathbf{i}} = B^J_{\mathbf{i}} \times B^{-J}_{\mathbf{i}}\)</span> for all <span class="math inline">\(\mathbf{i} \in \mathcal{I}\)</span>. The tensor product is here understood taking dimensions of <span class="math inline">\(\mathbb{I}^d = [0,1]^d\)</span> in the right order such that <span class="math inline">\(B^J_{\mathbf{i}}\)</span> dimensions end up in place of dimensions indexed by <span class="math inline">\(J\)</span>. Think of dimensions as re-ordered such that <span class="math inline">\(J = \{1,...,p\}\)</span>.</p>
<p>Let now <span class="math inline">\(\lambda\)</span> be the dimension-unspecified lebesgue measure on any power of <span class="math inline">\(\mathbb{R}\)</span>, that is :</p>
<p><span class="math display">\[\forall d \in \mathbb{N}, \forall \mathbf{x},\mathbf{y} \in \mathbb{R}^p, \lambda(\left[\mathbf{x},\mathbf{y}\right]) = \prod\limits_{p=1}^{d} (y_i - x_i)\]</span></p>
<p>Let furthermore <span class="math inline">\(\mu^J\)</span> be a copula measure of dimension <span class="math inline">\(p\)</span>, corresponding to the known multivariate margin associated to marginals in <span class="math inline">\(J\)</span>. Let also <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\hat{\mu}\)</span> be dimensionaly-unspecific version of the true copula measure of the sample at hand and (respectively) the classical Deheuvels empirical copula, that is :</p>
<ul>
<li>For <span class="math inline">\(n\)</span> i.i.d obeservation of the copula of dimension <span class="math inline">\(d\)</span>, let <span class="math inline">\(\forall i \in \{1,...,d\}, \, R_i^1,...,R_i^d\)</span> be the marginal ranks for the variable <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\forall \mathbf{x} \in \mathcal{I}^d, \text{ let } \hat{\mu}([0,x]) = \frac{1}{n} \sum\limits_{k=1}^n \mathbb{1}_{R_1^k\le x_1,...,R_d^k\le x_d}\)</span></li>
</ul>
<p>We are now ready to define the empirical checkerboard copula with known margins.</p>
</div>
<div id="definition-estimation-and-simulation-procedures" class="section level3">
<h3 class="hasAnchor">
<a href="#definition-estimation-and-simulation-procedures" class="anchor"></a>Definition, estimation and simulation procedures</h3>
<p>The empirical copula with known margins is the copula that correspond to the following simulation procedure, which is the starting point of our reflexion.</p>
<ul>
<li>Simulate a sample from the known sub-copula <span class="math inline">\(\mu^J\)</span>, of dimension <span class="math inline">\(p\)</span>, through any avaliable method (depends on the known copula model). Let <span class="math inline">\(B_{\mathbf{i}}^J\)</span> be the (projected) box containing this sample.</li>
<li>Sample one box <span class="math inline">\(B_{\mathbf{i}}\)</span> among all boxes with projection <span class="math inline">\(B_{\mathbf{i}}^J\)</span> with probability weights :
<ul>
<li>
<span class="math inline">\(\frac{\hat{\mu}(B_{\mathbf{i}})}{\hat{\mu}(B_{\mathbf{i}}^J)}\)</span> if the projected box <span class="math inline">\(B_{\mathbf{i}}^J\)</span> contains one or more (empirical) data point, that is <span class="math inline">\(\hat{\mu}(B_{\mathbf{i}}^J) \neq 0\)</span>
</li>
<li>
<span class="math inline">\(\frac{\lambda(B_{\mathbf{i}})}{\lambda(B_{\mathbf{i}}^J)}\)</span> otherwise.</li>
</ul>
</li>
<li>Simulate uniformly from <span class="math inline">\(B_{\mathbf{i}}^{-J}\)</span>
</li>
</ul>
<p>This algorithm simulates first the known part of the model (dimensions in <span class="math inline">\(J\)</span>), and then, conditionally, the checkerboard part, ensuring that the known copula is respected. The downside of this behavior is that the checkerboard part may have points outside standard checkerboard boxes, making this part of the copula less sparse than a true checkerboard. But is does become sparser as soon as the data fits the known margins. On the other hand, this algorithm allows for a lot of flexibility, mainly in the following points :</p>
<ul>
<li>The “grid” given by <span class="math inline">\(\mathcal{B}_\mathcal{I}\)</span> can be taken more arbitrarily than <span class="math inline">\(m^d\)</span> boxes of same volume, as soon as it’s a partition of <span class="math inline">\(\mathbb{I}^d\)</span>.</li>
<li>The known copula is <em>not</em> restricted at all and can be choose among all p-variates copulas.</li>
<li>The estimation of the checkerboard part can be turn into a more flexible <em>patchwork</em> construction, by changing the independence copula for an other one inside the boxes. See Durante2013,Durante2015,Durante2015a</li>
</ul>
<p>We are now going to define properly the measure associated to this simulation procedure, a.k.a the empirical checkerboard copula with known margins. Let <span class="math inline">\(\nu\)</span> be this measure and let <span class="math inline">\(\mathbf{U}\)</span> be a random vector drawn from it. Then <span class="math inline">\(\forall \mathbf{x} \in \mathbb{I}^d\)</span>, following the above procedure, we have :</p>
<p><span class="math display">\[\nu([0,\mathbf{x}]) = \sum\limits_{{\mathbf{i}} \in \mathcal{I}} \mathbb{P}(\mathbf{U}^{-J} \in B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}] | \mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) \mathbb{P}(\mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}])\]</span></p>
<p>While the unconditional term is easy to handle since it’s the measure associated with the known copula, <span class="math inline">\(\mathbb{P}(\mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) = \mu^J(B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}])\)</span>, the conditional term can be treated according to the algorithm : it will be <span class="math inline">\(\frac{\lambda(B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}])}{\lambda(B_{\mathbf{i}}^{-J})}\)</span> inside a box choosed with probability conditional on <span class="math inline">\(\hat{\mu}(B_{\mathbf{i}}^J) \neq 0\)</span>. We finaly get the following definition :</p>
<p><strong>The empirical checkerboard copula with parameter <span class="math inline">\(m\)</span> and with set of known margins <span class="math inline">\(J\)</span> following the measure <span class="math inline">\(\mu^J\)</span> is the copula corresponding to the measure <span class="math inline">\(\nu\)</span> given by : </strong></p>
<p><span class="math display">\[
\nu([0,x]) = \sum\limits_{{\mathbf{i}} \in \mathcal{I}} \mu^J(B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) \frac{\lambda(B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}])}{\lambda(B_{\mathbf{i}}^{-J})} \left[ \frac{\hat{\mu}(B_{\mathbf{i}})}{\hat{\mu}(B_{\mathbf{i}}^J)} \mathbb{1}_{\hat{\mu}(B_{\mathbf{i}}^J) \neq 0} + \frac{\lambda(B_{\mathbf{i}})}{\lambda(B_{\mathbf{i}}^J)} \mathbb{1}_{\hat{\mu}(B_{\mathbf{i}}^J) = 0}   \right]
\]</span></p>
<p>The next section will discuss the current implementation of this copula;</p>
</div>
</div>
<div id="current-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#current-implementation" class="anchor"></a>Current implementation</h2>
<p>The package implemnts the ECBC with known margins through the <code>cbkmCopula</code> class. The constructor of the class takes several arguments :</p>
<ul>
<li>
<code>x</code>, representing the pseudo_data.</li>
<li>
<code>m=nrow(x)</code>, repesenting the checkerboard parameter</li>
<li>
<code>pseudo=FALSE</code>, representing wether or not the pseudo_data is already given in a pseudo_observation form.</li>
<li>
<code>margins_numbers=NULL</code>, representing the margins index that are associated to the known copula, formerly noted <span class="math inline">\(J\)</span>
</li>
<li>
<code>known_cop=NULL</code>, representing the known copula to be applied to thoose margins : a copula object of right imension.</li>
</ul>
<p>for exemple, let’s work on some simulated datas, e.g a 4-dimension clayton copula simulated via the <code>copula</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">  true_copula &lt;-<span class="st"> </span><span class="kw">onacopulaL</span>(</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    <span class="dt">family =</span> <span class="st">"Clayton"</span>,</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="dt">nacList =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw">iTau</span>(<span class="kw">getAcop</span>(<span class="st">"Clayton"</span>), <span class="fl">0.6</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  dataset &lt;-<span class="st"> </span><span class="kw">rCopula</span>(<span class="dv">100</span>,true_copula)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(dataset) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"u"</span>,<span class="st">"v"</span>,<span class="st">"w"</span>,<span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(dataset,<span class="dt">lower.panel=</span><span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecbkm_files/figure-html/unnamed-chunk-1-1.png" alt="Pairs-plot of the simulated dataset" width="672"><p class="caption">
Pairs-plot of the simulated dataset
</p>
</div>
<p>And let’s suppose that the second bivariate margin is known, with a (well-estimated) clayton copula with <span class="math inline">\(\tau = 0.6\)</span> :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">  known_margins &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  known_clayton &lt;-<span class="st"> </span><span class="kw">onacopulaL</span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">family =</span> <span class="st">"Clayton"</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="dt">nacList =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw">iTau</span>(<span class="kw">getAcop</span>(<span class="st">"Clayton"</span>), <span class="fl">0.6</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  )</a></code></pre></div>
<p>Then we can construct the ECBC with this known margin :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">  cop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cbkmCopula.html">cbkmCopula</a></span>(<span class="dt">x =</span> dataset,<span class="dt">m =</span> <span class="dv">5</span>,<span class="dt">pseudo =</span> <span class="ot">TRUE</span>,<span class="dt">margins_numbers =</span> known_margins,<span class="dt">known_cop =</span> known_clayton)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Doing precalculations...</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;   Construct boxes</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;   Calculte empirical measures...</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;   End of loop</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;   Weights</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;   Exception_type</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;   Assigning and returning</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; Done !</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  cop</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; This is a cbkmCopula , with : </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;    dim = 4 </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;    n = 100 </span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;    m = 5 </span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; The variables names are :  u v w x </span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; The variables  2 3  have a known copula  given by :</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  Nested Archimedean copula ("outer_nacopula" of dim. 2), with slot </span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt;  'comp'   = (1, 2)  and root</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt;  'copula' = Archimedean copula ("acopula"), family "Clayton", theta= (3)</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt;  and *no* child copulas</span></a></code></pre></div>
<p>We can then simulate from it :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">  simu &lt;-<span class="st"> </span><span class="kw">rCopula</span>(<span class="dv">1000</span>,cop)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(simu,dataset),<span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"black"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simu)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"red"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dataset))),<span class="dt">gap=</span><span class="dv">0</span>,<span class="dt">lower.panel =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecbkm_files/figure-html/unnamed-chunk-4-1.png" alt="Pairs-plot of the original data (red) and simulated data from the true model (black)" width="672"><p class="caption">
Pairs-plot of the original data (red) and simulated data from the true model (black)
</p>
</div>
<p>You can see that the known-margin was respected.</p>
<p>What now if the known margins is clearly missspecified ?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">  wrong_clayton &lt;-<span class="st"> </span><span class="kw">onacopulaL</span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="dt">family =</span> <span class="st">"Clayton"</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="dt">nacList =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw">iTau</span>(<span class="kw">getAcop</span>(<span class="st">"Clayton"</span>), <span class="fl">0.1</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  cop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cbkmCopula.html">cbkmCopula</a></span>(<span class="dt">x =</span> dataset,<span class="dt">m =</span> <span class="dv">5</span>,<span class="dt">pseudo =</span> <span class="ot">TRUE</span>,<span class="dt">margins_numbers =</span> known_margins,<span class="dt">known_cop =</span> wrong_clayton)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; Doing precalculations...</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;   Construct boxes</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;   Calculte empirical measures...</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;   End of loop</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;   Weights</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;   Exception_type</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;   Assigning and returning</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; Done !</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  simu &lt;-<span class="st"> </span><span class="kw">rCopula</span>(<span class="dv">500</span>,cop)</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(simu,dataset),<span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"black"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simu)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"red"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dataset))),<span class="dt">gap=</span><span class="dv">0</span>,<span class="dt">lower.panel =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecbkm_files/figure-html/unnamed-chunk-5-1.png" alt="Pairs-plot of the original data (red) and simulated data from a wrong model (black)" width="672"><p class="caption">
Pairs-plot of the original data (red) and simulated data from a wrong model (black)
</p>
</div>
<p>The conditioning mecanisme did suffer for the dependances inside the known multidimentional margin but also for dependancies involving one of the variables from thoose known margins. But the checkerboard construction for the other part of the copula was not harmed.</p>
<p>What now if the 2 parts are clearly independant ?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  true_copula1 &lt;-<span class="st"> </span><span class="kw">onacopulaL</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">family =</span> <span class="st">"Clayton"</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="dt">nacList =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw">iTau</span>(<span class="kw">getAcop</span>(<span class="st">"Clayton"</span>), <span class="fl">0.8</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  true_copula2 &lt;-<span class="st"> </span><span class="kw">onacopulaL</span>(</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">    <span class="dt">family =</span> <span class="st">"Clayton"</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="dt">nacList =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw">iTau</span>(<span class="kw">getAcop</span>(<span class="st">"Clayton"</span>), <span class="fl">0.8</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  dataset &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw">rCopula</span>(<span class="dv">100</span>,true_copula1),<span class="kw">rCopula</span>(<span class="dv">100</span>,true_copula2))</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(dataset) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"u"</span>,<span class="st">"v"</span>,<span class="st">"w"</span>,<span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(dataset,<span class="dt">lower.panel=</span><span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecbkm_files/figure-html/unnamed-chunk-6-1.png" alt="Pairs-plot of the original data with independance" width="672"><p class="caption">
Pairs-plot of the original data with independance
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">  cop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cbkmCopula.html">cbkmCopula</a></span>(<span class="dt">x =</span> dataset,<span class="dt">m =</span> <span class="dv">5</span>,<span class="dt">pseudo =</span> <span class="ot">TRUE</span>,<span class="dt">margins_numbers =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dt">known_cop =</span> wrong_clayton)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; Doing precalculations...</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;   Construct boxes</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;   Calculte empirical measures...</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;   End of loop</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;   Weights</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;   Exception_type</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;   Assigning and returning</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; Done !</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  simu &lt;-<span class="st"> </span><span class="kw">rCopula</span>(<span class="dv">500</span>,cop)</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(simu,dataset),<span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"black"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simu)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"red"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(dataset))),<span class="dt">gap=</span><span class="dv">0</span>,<span class="dt">lower.panel =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecbkm_files/figure-html/unnamed-chunk-7-1.png" alt="Pairs-plot of the original data (red) and simulated data from a wrong model (black) -- Independance case" width="672"><p class="caption">
Pairs-plot of the original data (red) and simulated data from a wrong model (black) – Independance case
</p>
</div>
<p>We can see that the wrong specification of the clayton copula for the 2 firsts margins (u,v) dit not impact at all the checkerboard construction for the 2 other margins.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#ecbc-with-known-margins">ECBC with known margins</a></li>
      <li><a href="#current-implementation">Current implementation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Oskar Laverny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>

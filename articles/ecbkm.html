<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Empirical Checkerboard Copula with known margins â€¢ empCop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Checkerboard Copula with known margins">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">empCop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/convexcombcopula.html">Convex combination of checkerbords with known margins</a>
    </li>
    <li>
      <a href="../articles/ecb.html">Empirical Checkerboard Copula</a>
    </li>
    <li>
      <a href="../articles/ecbkm.html">Empirical Checkerboard Copula with known margins</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrnv/empCop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Empirical Checkerboard Copula with known margins</h1>
                        <h4 class="author">Oskar Laverny</h4>
            
            <h4 class="date">2019-02-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrnv/empCop/blob/master/vignettes/ecbkm.Rmd"><code>vignettes/ecbkm.Rmd</code></a></small>
      <div class="hidden name"><code>ecbkm.Rmd</code></div>

    </div>

    
    
<!-- The empirical checkerboard copula with known margins is a model for copula that uses priori information on a multidimentional margins to condition a checkerboard construction on the rest of the copula. This vignette describes the model in the first section, and then discuss current implementation in the second section -->
<!-- ## ECBC with known margins -->
<!-- ### Preliminary notations -->
<!-- First of all, for a certain dimension of the data at hand $d$ and a certain checkerboard parameter $m$, let's consider the ensemble of multi-indexes $\mathcal{I} = \{\mathbf{i} = (i_1,..,i_d) \subset \{1,...,m \}^d\}$ which indexes the boxes :  -->
<!-- $$B_{\mathbf{i}} = \left]\frac{\mathbf{i}-1}{m},\frac{\mathbf{i}}{m}\right]$$ -->
<!-- partitioning the space $\mathbb{I}^d = [0,1]^d$. Denote the set of thoose boxes by $\mathcal{B}_\mathcal{I} = \left\{B_{\mathbf{i}}, \mathbf{i} \in \mathcal{I}\right\}$. Furthermore, let's choose $p$ dimensions that would be assigned to a known copula, by setting : $J \subset \{1,...,d\}, |J| = p$ and let's define proper projections for the boxes :  -->
<!-- $$B^J_{\mathbf{i}} = \{ \mathbf{x} \in [0,1]^p, x_j \in \left]\frac{i_j-1}{m},\frac{i_j}{m}\right] \forall j \in J \}$$ -->
<!-- $$B^{-J}_{\mathbf{i}} = \{\mathbf{x} \in [0,1]^p, x_j \in \left]\frac{i_j-1}{m},\frac{i_j}{m}\right] \forall j \notin J \}$$ -->
<!-- such that $B_{\mathbf{i}} = B^J_{\mathbf{i}} \times B^{-J}_{\mathbf{i}}$ for all $\mathbf{i} \in \mathcal{I}$. The tensor product is here understood taking dimensions of $\mathbb{I}^d = [0,1]^d$ in the right order such that $B^J_{\mathbf{i}}$ dimensions end up in place of dimensions indexed by $J$. Think of dimensions as re-ordered such that $J = \{1,...,p\}$. -->
<!-- Let now $\lambda$ be the dimension-unspecified lebesgue measure on any power of $\mathbb{R}$, that is :  -->
<!-- $$\forall d \in \mathbb{N}, \forall \mathbf{x},\mathbf{y} \in \mathbb{R}^p, \lambda(\left[\mathbf{x},\mathbf{y}\right]) = \prod\limits_{p=1}^{d} (y_i - x_i)$$ -->
<!-- Let furthermore $\mu^J$ be a copula measure of dimension $p$, corresponding to the known multivariate margin associated to marginals in $J$. Let also $\mu$ and $\hat{\mu}$ be dimensionaly-unspecific  version of the true copula measure of the sample at hand and (respectively) the classical Deheuvels empirical copula, that is :  -->
<!-- - For $n$ i.i.d obeservation of the copula of dimension $d$, let $\forall i \in \{1,...,d\}, \, R_i^1,...,R_i^d$ be the marginal ranks for the variable $i$.  -->
<!-- - $\forall \mathbf{x} \in \mathcal{I}^d, \text{ let } \hat{\mu}([0,x]) = \frac{1}{n} \sum\limits_{k=1}^n \mathbb{1}_{R_1^k\le x_1,...,R_d^k\le x_d}$ -->
<!-- We are now ready to define the empirical checkerboard copula with known margins.  -->
<!-- ### Definition, estimation and simulation procedures -->
<!-- The empirical copula with known margins is the copula that correspond to the following simulation procedure, which is the starting point of our reflexion.  -->
<!-- - Simulate a sample from the known sub-copula $\mu^J$, of dimension $p$, through any avaliable method (depends on the known copula model). Let $B_{\mathbf{i}}^J$ be the (projected) box containing this sample.  -->
<!-- - Sample one box $B_{\mathbf{i}}$ among all boxes with projection $B_{\mathbf{i}}^J$ with probability weights : -->
<!--   -  $\frac{\hat{\mu}(B_{\mathbf{i}})}{\hat{\mu}(B_{\mathbf{i}}^J)}$ if the projected box $B_{\mathbf{i}}^J$ contains one or more (empirical) data point, that is $\hat{\mu}(B_{\mathbf{i}}^J) \neq 0$ -->
<!--    - $\frac{\lambda(B_{\mathbf{i}})}{\lambda(B_{\mathbf{i}}^J)}$ otherwise. -->
<!-- - Simulate uniformly from $B_{\mathbf{i}}^{-J}$  -->
<!-- This algorithm simulates first the known part of the model (dimensions in $J$), and then, conditionally, the checkerboard part, ensuring that the known copula is respected. The downside of this behavior is that the checkerboard part may have points outside standard checkerboard boxes, making this part of the copula less sparse than a true checkerboard. But is does become sparser as soon as the data fits the known margins. On the other hand, this algorithm allows for a lot of flexibility, mainly in the following points :  -->
<!-- - The "grid" given by $\mathcal{B}_\mathcal{I}$ can be taken more arbitrarily than $m^d$ boxes of same volume, as soon as it's a partition of $\mathbb{I}^d$. -->
<!-- - The known copula is *not* restricted at all and can be choose among all p-variates copulas.  -->
<!-- - The estimation of the checkerboard part can be turn into a more flexible *patchwork* construction, by changing the independence copula for an other one inside the boxes. See Durante2013,Durante2015,Durante2015a -->
<!-- We are now going to define properly the measure associated to this simulation procedure, a.k.a the empirical checkerboard copula with known margins. Let $\nu$ be this measure and let $\mathbf{U}$ be a random vector drawn from it. Then $\forall \mathbf{x} \in \mathbb{I}^d$, following the above procedure, we have :   -->
<!-- $$ -->
<!--    \begin{split} -->
<!--    \nu([0,\mathbf{x}]) &= \mathbb{P}(\mathbf{U}\le \mathbf{x}) \\ -->
<!--               &= \sum\limits_{{\mathbf{i}} \in \mathcal{I}} \mathbb{P}(\mathbf{U} \in B_{\mathbf{i}}, \mathbf{U} \le \mathbf{x}) \\ -->
<!--               &= \sum\limits_{{\mathbf{i}} \in \mathcal{I}} \mathbb{P}(\mathbf{U}^{-J} \in B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}] | \mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) \mathbb{P}(\mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) -->
<!--    \end{split} -->
<!-- $$          -->
<!-- While the unconditional term is easy to handle since it's the measure associated with the known copula, $\mathbb{P}(\mathbf{U}^{J} \in B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) = \mu^J(B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}])$, the conditional term can be treated according to the algorithm : it will be $\frac{\lambda(B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}])}{\lambda(B_{\mathbf{i}}^{-J})}$ inside a box choosed with probability conditional on $\hat{\mu}(B_{\mathbf{i}}^J) \neq 0$. We finaly get the following definition : -->
<!-- **The empirical checkerboard copula with parameter $m$ and with set of known margins $J$ following the measure $\mu^J$ is the copula corresponding to the measure $\nu$ given by : ** -->
<!-- $$ -->
<!-- \nu([0,x]) = \sum\limits_{{\mathbf{i}} \in \mathcal{I}} \mu^J(B_{\mathbf{i}}^{J} \cap [0,\mathbf{x}^{J}]) \frac{\lambda(B_{\mathbf{i}}^{-J} \cap [0,\mathbf{x}^{-J}])}{\lambda(B_{\mathbf{i}}^{-J})} \left[ \frac{\hat{\mu}(B_{\mathbf{i}})}{\hat{\mu}(B_{\mathbf{i}}^J)} \mathbb{1}_{\hat{\mu}(B_{\mathbf{i}}^J) \neq 0} + \frac{\lambda(B_{\mathbf{i}})}{\lambda(B_{\mathbf{i}}^J)} \mathbb{1}_{\hat{\mu}(B_{\mathbf{i}}^J) = 0}   \right] -->
<!-- $$ -->
<!-- The next section will discuss the current implementation of this copula; -->
<!-- ## Current implementation  -->
<!-- The package implemnts the ECBC with known margins through the `cbkmCopula` class. The constructor of the class takes several arguments :  -->
<!-- - `x`, representing the pseudo_data. -->
<!-- - `m=nrow(x)`, repesenting the checkerboard parameter -->
<!-- - `pseudo=FALSE`, representing wether or not the pseudo_data is already given in a pseudo_observation form. -->
<!-- - `margins_numbers=NULL`, representing the margins index that are associated to the known copula, formerly noted $J$ -->
<!-- - `known_cop=NULL`, representing the known copula to be applied to thoose margins : a copula object of right imension.  -->
<!-- for exemple, let's work on some simulated datas, e.g a 4-dimension clayton copula simulated via the `copula` package. -->
<!-- ```{r,fig.cap="Pairs-plot of the simulated dataset"} -->
<!--   # true_copula <- onacopulaL( -->
<!--   #   family = "Clayton", -->
<!--   #   nacList = list(iTau(getAcop("Clayton"), 0.6), 1:4) -->
<!--   # ) -->
<!--   # dataset <- rCopula(100,true_copula)  -->
<!--   # colnames(dataset) <- c("u","v","w","x") -->
<!--   # pairs(dataset,lower.panel=NULL) -->
<!-- ``` -->
<!-- And let's suppose that the second bivariate margin is known, with a (well-estimated) clayton copula with $\tau = 0.6$ :  -->
<!-- ```{r} -->
<!--   # known_margins <- c(2,3) -->
<!--   # known_clayton <- onacopulaL( -->
<!--   #   family = "Clayton", -->
<!--   #   nacList = list(iTau(getAcop("Clayton"), 0.6), 1:2) -->
<!--   # ) -->
<!-- ``` -->
<!-- Then we can construct the ECBC with this known margin :  -->
<!-- ```{r} -->
<!--   # cop <- cbkmCopula(x = dataset,m = 5,pseudo = TRUE,margins_numbers = known_margins,known_cop = known_clayton) -->
<!--   # cop -->
<!-- ``` -->
<!-- We can then simulate from it :  -->
<!-- ```{r, fig.cap="Pairs-plot of the original data (red) and simulated data from the true model (black)"} -->
<!--   # simu <- rCopula(1000,cop) -->
<!--   # pairs(rbind(simu,dataset),col=c(rep("black",nrow(simu)),rep("red",nrow(dataset))),gap=0,lower.panel = NULL) -->
<!-- ``` -->
<!-- You can see that the known-margin was respected.  -->
<!-- What now if the known margins is clearly missspecified ?  -->
<!-- ```{r, fig.cap="Pairs-plot of the original data (red) and simulated data from a wrong model (black)"} -->
<!--   # wrong_clayton <- onacopulaL( -->
<!--   #   family = "Clayton", -->
<!--   #   nacList = list(iTau(getAcop("Clayton"), 0.1), 1:2) -->
<!--   # ) -->
<!--   # cop <- cbkmCopula(x = dataset,m = 5,pseudo = TRUE,margins_numbers = known_margins,known_cop = wrong_clayton) -->
<!--   #  -->
<!--   # simu <- rCopula(500,cop) -->
<!--   # pairs(rbind(simu,dataset),col=c(rep("black",nrow(simu)),rep("red",nrow(dataset))),gap=0,lower.panel = NULL) -->
<!-- ``` -->
<!-- The conditioning mecanisme did suffer for the dependances inside the known multidimentional margin but also for dependancies involving one of the variables from thoose known margins. But the checkerboard construction for the other part of the copula was not harmed. -->
<!-- What now if the 2 parts are clearly independant ?  -->
<!-- ```{r, fig.cap="Pairs-plot of the original data with independance"} -->
<!--   # true_copula1 <- onacopulaL( -->
<!--   #   family = "Clayton", -->
<!--   #   nacList = list(iTau(getAcop("Clayton"), 0.8), 1:2) -->
<!--   # ) -->
<!--   # true_copula2 <- onacopulaL( -->
<!--   #   family = "Clayton", -->
<!--   #   nacList = list(iTau(getAcop("Clayton"), 0.8), 1:2) -->
<!--   # ) -->
<!--   #  -->
<!--   # dataset <- cbind(rCopula(100,true_copula1),rCopula(100,true_copula2)) -->
<!--   # colnames(dataset) <- c("u","v","w","x") -->
<!--   # pairs(dataset,lower.panel=NULL) -->
<!-- ``` -->
<!-- ```{r, fig.cap="Pairs-plot of the original data (red) and simulated data from a wrong model (black) -- Independance case"} -->
<!--   # cop <- cbkmCopula(x = dataset,m = 5,pseudo = TRUE,margins_numbers = c(1,2),known_cop = wrong_clayton) -->
<!--   # simu <- rCopula(500,cop) -->
<!--   # pairs(rbind(simu,dataset),col=c(rep("black",nrow(simu)),rep("red",nrow(dataset))),gap=0,lower.panel = NULL) -->
<!-- ``` -->
<!-- We can see that the wrong specification of the clayton copula for the 2 firsts margins (u,v) dit not impact at all the checkerboard construction for the 2 other margins. -->
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Oskar Laverny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Empirical Checkerboard Copula • empCop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Checkerboard Copula">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">empCop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/convexcombcopula.html">Convex combination of copulas</a>
    </li>
    <li>
      <a href="../articles/ecb.html">Empirical Checkerboard Copula</a>
    </li>
    <li>
      <a href="../articles/ecbkm.html">Empirical Checkerboard Copula with known margins</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrnv/empCop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Empirical Checkerboard Copula</h1>
                        <h4 class="author">Oskar Laverny</h4>
            
            <h4 class="date">2019-02-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrnv/empCop/blob/master/vignettes/ecb.Rmd"><code>vignettes/ecb.Rmd</code></a></small>
      <div class="hidden name"><code>ecb.Rmd</code></div>

    </div>

    
    
<p>The empirical checkerboard copula is a model for copula defined by Cuberos (citation?). In this first section fo this vignette, we will set notations and define the model. The second section will discuss and demonstrate the implementation made in the package.</p>
<div id="definition-of-the-empirical-checkerboard-copula" class="section level2">
<h2 class="hasAnchor">
<a href="#definition-of-the-empirical-checkerboard-copula" class="anchor"></a>Definition of the empirical checkerboard copula</h2>
<p>Suppose that we have a dataset with <span class="math inline">\(n\)</span> i.i.d observation of a <span class="math inline">\(d\)</span>-dimentional copula (or pseudo-observations). Take the chckerboard parameter <span class="math inline">\(m\)</span> to be an integer dividing <span class="math inline">\(n\)</span>.</p>
<p>First of all, for a certain dimension of the data at hand <span class="math inline">\(d\)</span> and a certain checkerboard parameter <span class="math inline">\(m\)</span>, let’s consider the ensemble of multi-indexes <span class="math inline">\(\mathcal{I} = \{\mathbf{i} = (i_1,..,i_d) \subset \{1,...,m \}^d\}\)</span> which indexes the boxes :</p>
<p><span class="math display">\[B_{\mathbf{i}} = \left]\frac{\mathbf{i}-1}{m},\frac{\mathbf{i}}{m}\right]\]</span></p>
<p>partitioning the space <span class="math inline">\(\mathbb{I}^d = [0,1]^d\)</span>.</p>
<p>Let now <span class="math inline">\(\lambda\)</span> be the dimension-unspecified lebesgue measure on any power of <span class="math inline">\(\mathbb{R}\)</span>, that is :</p>
<p><span class="math display">\[\forall d \in \mathbb{N}, \forall x,y \in \mathbb{R}^p, \lambda(\left[x,y\right]) = \prod\limits_{p=1}^{d} (y_i - x_i)\]</span></p>
<p>Let furthermore <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\hat{\mu}\)</span> be respectively the true copula measure of the sample at hand and the classical Deheuvels empirical copula, that is :</p>
<ul>
<li>For <span class="math inline">\(n\)</span> i.i.d obeservation of the copula of dimension <span class="math inline">\(d\)</span>, let <span class="math inline">\(\forall i \in \{1,...,d\}, \, R_i^1,...,R_i^d\)</span> be the marginal ranks for the variable <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\forall x \in \mathcal{I}^d, \text{ let } \hat{\mu}([0,x]) = \frac{1}{n} \sum\limits_{k=1}^n \mathbb{1}_{R_1^k\le x_1,...,R_d^k\le x_d}\)</span></li>
</ul>
<p>We are now ready to define the checkerboard copula, <span class="math inline">\(C\)</span>, and the empirical checkerboard copula, <span class="math inline">\(\hat{C}\)</span>, by the following :</p>
<p><span class="math display">\[\forall x \in [0,1]^d, C(x) = \sum\limits_{\mathbf{i}\in\mathcal{I}} {m^d \mu(B_{\mathbf{i}}) \lambda([0,\mathbf{x}]\cup B_{\mathbf{i}})}\]</span></p>
<p>Where <span class="math inline">\(m^d = \lambda(B_{\mathbf{i}})\)</span>.</p>
<p>This copula is a special form of patchwork copulas (see Durante) and some results are known about it : it is indeed a copula, it converges to the true copula as the mesh (size of boxes) goes to zero, etc..</p>
<p>This package gives a comprehensive implementation of the empirical conterpart of this copula, wich has exactly the same expression exept that <span class="math inline">\(\mu\)</span>, the true copula of the sample, is replace by it’s deheuvel approximation <span class="math inline">\(\hat{\mu}\)</span>, that is :</p>
<p><span class="math display">\[\forall x \in [0,1]^d, \hat{C}(x) = \sum\limits_{\mathbf{i}\in\mathcal{I}} {m^d \hat{\mu}(B_{\mathbf{i}}) \lambda([0,\mathbf{x}]\cup B_{\mathbf{i}})}\]</span></p>
<p>A known result is that this is a copula if and only if <span class="math inline">\(m\)</span> divides <span class="math inline">\(n\)</span> (see cuberos). In this case, some theoretical limiting results are avaliables.</p>
<p>The next section will discuss how one could use this copula in R.</p>
</div>
<div id="implementation-of-this-model" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation-of-this-model" class="anchor"></a>Implementation of this model</h2>
<p>In our package, this empirical checkerboard copula, here called ECBC, is implemented in the <code>cbCopula</code> class.</p>
<p>To create one of theese copula, you will need a dataset to start with. For the matter of this vignette, we will use the <code>LifeCycleSavings</code> dataset, which has following pairs dependencies plot :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"LifeCycleSavings"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">pseudo_data &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(LifeCycleSavings,<span class="dv">2</span>,rank,<span class="dt">ties.method=</span><span class="st">"max"</span>)<span class="op">/</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(LifeCycleSavings)<span class="op">+</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(pseudo_data,<span class="dt">col=</span><span class="st">"2"</span>,<span class="dt">lower.panel=</span><span class="ot">NULL</span>,<span class="dt">gap=</span><span class="dv">0</span>)</a></code></pre></div>
<div class="figure">
<img src="ecb_files/figure-html/unnamed-chunk-1-1.png" alt="Pairs-plot of original peusdo-observation from the data" width="672"><p class="caption">
Pairs-plot of original peusdo-observation from the data
</p>
</div>
<p>You can see that the variable 2 to 4 have noticeable dependencies structures, while the first and last one are harder to diagnose on this graphics. The dataset having <span class="math inline">\(n=50\)</span> rows, we will pick a value of <span class="math inline">\(m\)</span> dividing <span class="math inline">\(50\)</span>, e.g <span class="math inline">\(m=5\)</span>, and use the function <code>cbCopula</code> to build our copula model. Since we are already providing the pseudo observations, we will set <code>pseudo = TRUE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">m=<span class="dv">5</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">cop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cbCopula.html">cbCopula</a></span>(<span class="dt">x =</span> pseudo_data,<span class="dt">m =</span> m,<span class="dt">pseudo =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">cop</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; This is a cbCopula , with : </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;    dim = 5 </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;    n = 50 </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;    m = 5 </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; The variables names are :  sr pop15 pop75 dpi ddpi</span></a></code></pre></div>
<p>For the moment, only some methods exist for this copula. We can calculate it’s values via the <code>pCopula</code> method, get it’s dimention via the <code>dim</code> method, or simulate from it via the <code>rCopula</code> method. Here is an exemple of simulation from this model :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">simu &lt;-<span class="st"> </span><span class="kw">rCopula</span>(<span class="dt">n =</span> <span class="dv">1000</span>,<span class="dt">copula =</span> cop)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/pairs">pairs</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(simu,pseudo_data),</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">      <span class="dt">col=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"black"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simu)),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"red"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(pseudo_data))),</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">      <span class="dt">gap=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">      <span class="dt">lower.panel=</span><span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="ecb_files/figure-html/unnamed-chunk-3-1.png" alt="Pairs-plot of original peusdo-observation from the data (red) with simulated pseudo_observation (black)" width="672"><p class="caption">
Pairs-plot of original peusdo-observation from the data (red) with simulated pseudo_observation (black)
</p>
</div>
<p>There also exist a <code>pCopula</code> methods to calculate the value of the copula itself. It can be easily used by passing a simple vector or a matrix as first argument. for exmeple, let’s see the cooordinates 2 and 3 :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">grid &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/expand.grid">expand.grid</a></span>(<span class="dt">z=</span><span class="dv">1</span>,<span class="dt">x=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length.out=</span><span class="dv">30</span>),<span class="dt">y=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length.out=</span><span class="dv">30</span>),<span class="dt">t=</span><span class="dv">1</span>,<span class="dt">u=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">value &lt;-<span class="st"> </span><span class="kw">pCopula</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(grid),cop)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"scatterplot3d"</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Warning: le package 'scatterplot3d' a été compilé avec la version R 3.4.4</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">scatterplot3d</span>(grid<span class="op">$</span>x,grid<span class="op">$</span>y,value)</a></code></pre></div>
<div class="figure">
<img src="ecb_files/figure-html/unnamed-chunk-4-1.png" alt="Plot of the copula itself" width="672"><p class="caption">
Plot of the copula itself
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#definition-of-the-empirical-checkerboard-copula">Definition of the empirical checkerboard copula</a></li>
      <li><a href="#implementation-of-this-model">Implementation of this model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Oskar Laverny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
